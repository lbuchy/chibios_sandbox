PROGRAMMING UTILITY SCRIPTS

The scripts in this directory help create and manage uploadable software images
encryption/signature keys using the prog_util application. This application is 
built separately in the bootloader source tree and installed into /usr/local/bin.

The following scripts are available:

makeimage.sh	- Create a software image from a binary file
upload.sh		- Upload a software image to the board
uploadkey.sh	- Upload encryption/signing keys to the board
lockkey.sh		- Lock encryption/signing keys from further modification

CREATING SOFTWARE IMAGES FROM BINARY FILES (makeimage.sh)

The build process in the app directory creates a raw binary (.bin) file along with
the ELF file. Building the application by typing "make" in the app directory creates
an image that runs directly from the default location (0x08000000). The software
image requires a binary file that is linked to the bank address (e.g. 0x08023200 for
Bank A) because it has to run directly from the Flash location. This is done by
invoking make with an additional parameter. e.g.:

make BANK=A

This uses a different link map file (GenistBankA.ld).

The resulting binary file is wrapped with a 512 byte image header containing CRCs
and a signature area. The image is then encrypted using the Blowfish algorithm. 

CREATING RSA SIGNATURE AND BLOWFISH KEYS

The RSA key is used to sign the software image to ensure that the image has not
been tampered with. The Blowfish key is used to encrypt the image to make it
unreadable. The bootloader will not correctly decrypt the image if the Blowfish
encryption and decryption keys do not match and will not get a proper file header.

The signature area is created by encrypting the image header along with the
image's MD5 digest using the RSA private key. The bootloader decrypts the signature
area with the RSA public key and compares the resulting data against the image
header and MD5 digest it calculated on the binary image. The bootloader will only
validate the image if they match.

The key files provided in the repository are examples only and should not be used
for production code as they are public. New key files should be created locally and
kept in a private directory and not checked into a public repository.

The RSA key is randomly generated using openSSL:

openssl genpkey -out rsakey.der -outform DER -algorithm RSA

The contents can be read as follows:

openssl asn1parse -in rsakey.der -inform DER

The Blowfish key is a hex string of up to 256 bytes (2048 bits). This key
can be generated by openssl as well:

openssl rand -hex 256 -out blowfish.key

Note that this method does not necessarily guarantee a "good" Blowfish key.